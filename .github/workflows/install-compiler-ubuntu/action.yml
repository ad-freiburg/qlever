name: "Install various versions of gcc and clang"
description: "dummy description"
inputs:
  compiler:
    description: "Must be `gcc` or `clang`"
    required: true
  compiler-version:
    description: "the version of the compiler (must be major version)"
    required: true

runs:
  using: "composite"
  steps:
    - name: Add PPA for GCC try 1
      if: inputs.compiler == 'gcc'
      id: ppa1
      run : sudo add-apt-repository ppa:ubuntu-toolchain-r/test && sudo apt update
      continue-on-error: true
      shell: bash
    - name: Add PPA for GCC try 2
      if: inputs.compiler == 'gcc' && steps.ppa1.outcome=='failure'
      id: ppa2
      run : sudo add-apt-repository ppa:ubuntu-toolchain-r/test && sudo apt update
      continue-on-error: true
      shell: bash

    - name: Add PPA for GCC try 3
      if: inputs.compiler == 'gcc' && steps.ppa2.outcome=='failure'
      id: ppa3
      run : sudo add-apt-repository ppa:ubuntu-toolchain-r/test && sudo apt update
      continue-on-error: false
      shell: bash

    - name: Install gcc
      if :  inputs.compiler == 'gcc'
      run : sudo apt install -y gcc-${{inputs.compiler-version}} g++-${{inputs.compiler-version}}
      shell: bash

    - name: Install clang
      if :  inputs.compiler == 'clang'
      # The sed command fixes a bug in `llvm.sh` in combination with the latest version of
      # `apt-key`. Without it the GPG key for the llvm repository is downloaded but deleted
      # immediately after.
      run:  |
        wget https://apt.llvm.org/llvm.sh
        sudo chmod +x llvm.sh
        sed   's/apt-key del/echo/' llvm.sh -iy
        sudo ./llvm.sh ${{inputs.compiler-version}}
        sudo apt install -y clang-${{inputs.compiler-version}}
      shell: bash

# TODO<joka921> Add assertion for unsupported compilers and versions.
